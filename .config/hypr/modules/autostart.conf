#----------------------------------------------------------
#--  OPTIMIZED: Autostart
#----------------------------------------------------------

# Core Components
exec-once = waybar & swww-daemon & swaync & hypridle
exec-once = /usr/lib/polkit-kde-authentication-agent-1
exec-once = wl-paste --type text --watch cliphist store 
exec-once = wl-paste --type image --watch cliphist store
exec-once = swayosd-server --top-margin 0
exec-once = systemctl --user start hyprpolkitagent
exec-once = udiskie &

# --- PORTAL FIX START ---
# 1. Push environment to D-Bus and Systemd
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=Hyprland
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# 2. Reset failed state (Stops the "Start request repeated too quickly" error)
exec-once = sleep 1 && systemctl --user reset-failed xdg-desktop-portal-hyprland
exec-once = sleep 1 && systemctl --user reset-failed xdg-desktop-portal

# 3. Restart the service once the environment is synced
exec-once = sleep 2 && systemctl --user restart xdg-desktop-portal-hyprland
exec-once = sleep 2 && systemctl --user restart xdg-desktop-portal
# --- PORTAL FIX END ---
